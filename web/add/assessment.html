<form id="istr-i52" class="generated-form">
<p style="display: none;">
<label>
Таблица<br>
<input type="text" name="table" value="assessments"> <br>
</label>
</p>

<fieldset>
<legend>Данные</legend>
<p>
<label>
Дата <br>
<input type="date" name="data[date]" value=""> <br>
</label>
</p>

<p>
<label>
Предмет<br>
<input type="text" name="data[lesson]" value=""> <br>
</label>
</p>

<p>
<label>
Ученик<br>
<input type="text" name="data[disciple]" value=""> <br>
</label>
</p>

<p>
<label>
Оценка<br>
<input type="number" max=5 name="data[assessment]" value=""> <br>
</label>
</p>
</fieldset>

<p><button>Отправить</button></p>
</form>
<script>!function(){function e(e){if(localStorage.getItem("login")&&localStorage.getItem("PostingKey"))viz_login=localStorage.getItem("login"),posting_key=sjcl.decrypt(viz_login+"_postingKey",localStorage.getItem("PostingKey"));else if(sessionStorage.getItem("login")&&sessionStorage.getItem("PostingKey"))viz_login=sessionStorage.getItem("login"),posting_key=sjcl.decrypt(viz_login+"_postingKey",sessionStorage.getItem("PostingKey"));else{document.getElementById(e)&&(document.getElementById(e).style.display="none");var t=document.createElement("div");t.innerHTML='<form id="auth_form" action="index.html" method="GET"><p class="auth_title"><strong>Пожалуйста авторизируйтесь</strong></p><p><input type="text" id="this_login" name="viz_login" placeholder="Ваш логин"></p><p><input type="password" name="posting" id="this_posting" placeholder="Приватный постинг ключ"></p><p><input type="submit" value="Войти"></p></form>',document.getElementById(e).parentNode.insertAdjacentElement("beforeend",t),document.getElementById("auth_form").onsubmit=function(t){t.preventDefault(),async function(e){let t=document.getElementById("this_login").value,o=document.getElementById("this_posting").value;if(localStorage.getItem("PostingKey"))var n=sjcl.decrypt(t+"_postingKey",localStorage.getItem("PostingKey"));else if(sessionStorage.getItem("PostingKey"))var n=sjcl.decrypt(t+"_postingKey",sessionStorage.getItem("PostingKey"));else var n=o;if(!0===viz.auth.isWif(n)){const e=await viz.api.getAccountsAsync([t]),s=viz.auth.wifToPublic(n);let i=[];if(e.length>0)for(key of e[0].regular_authority.key_auths)i.push(key[0]);else window.alert("Вероятно, аккаунт не существует. Просьба проверить введённый логин.");i.includes(s)?(localStorage.setItem("login",t),localStorage.setItem("PostingKey",sjcl.encrypt(t+"_postingKey",o)),sessionStorage.setItem("login",t),sessionStorage.setItem("PostingKey",sjcl.encrypt(t+"_postingKey",o)),viz_login=t,posting_key=n):0===e.length?window.alert("Аккаунт не существует. Пожалуйста, проверьте его"):window.alert("Постинг ключ не соответствует пренадлежащему аккаунту.")}else window.alert("Постинг ключ имеет неверный формат. Пожалуйста, попробуйте ещё раз.");viz_login||posting_key?(document.getElementById(e)&&(document.getElementById(e).style.display="block"),document.getElementById("auth_form").remove()):alert("Не удалось авторизироваться с текущей парой логин/ключ")}(e)}}}var t=document.querySelector(".generated-form").id;document.querySelector(".generated-form").querySelector("button").disabled=!0;setTimeout(function o(){window.hasOwnProperty("viz")?(console.log("done"),function(){const e=["wss://ws.viz.ropox.app","wss://vizlite.lexai.host/","wss://solox.world/ws"];let t=localStorage.getItem("node")||e[0];const o=Math.max(e.indexOf(t),0),n=o=>{o>=e.length&&(o=0),0>=e.length?alert("no working nodes found"):(t=e[o],viz.config.set("websocket",t),viz.api.getDynamicGlobalPropertiesAsync().then(e=>{console.log("found working node",t),localStorage.setItem("node",t)}).catch(e=>{console.log("connection error",t,e),n(o+1)}))};n(o)}(),e(t),document.querySelector(".generated-form").querySelector("button").disabled=!1):(console.log("wait"),setTimeout(o,50))},0);document.querySelector(".generated-form").onsubmit=function(e){e.preventDefault(),this.querySelector("button").disabled=!0;var t=new XMLHttpRequest;t.open("POST","https://viz.dpos.space/custom/json_encode.php"),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onload=function(){200===t.status?(console.log(t.responseText),viz.broadcast.custom(posting_key,[],[viz_login],document.querySelector(".generated-form").id,t.responseText,function(e,t){e?alert("Ошибка: "+e):(alert("Ок. custom отправлен"),console.log(t)),document.querySelector(".generated-form").querySelector("button").disabled=!1})):alert("Request failed.  Returned status of "+t.status)},t.send(function(e){for(var t=[],o=0;o<e.elements.length;o++){var n=e.elements[o];if(n.name&&!n.disabled&&"file"!==n.type&&"reset"!==n.type&&"submit"!==n.type&&"button"!==n.type)if("select-multiple"===n.type)for(var s=0;s<n.options.length;s++)n.options[s].selected&&t.push(encodeURIComponent(n.name)+"="+encodeURIComponent(n.options[s].value));else("checkbox"!==n.type&&"radio"!==n.type||n.checked)&&t.push(encodeURIComponent(n.name)+"="+encodeURIComponent(n.value))}return t.join("&")}(document.querySelector(".generated-form")))}}()</script>